---
sidebar: sidebar
permalink: concept_anomaly_detection.html
keywords: Anomalies, anomaly, patterns, monitor, alert
summary: Monitor metrics for anomalies
---
= Anomaly Detection
:toc: macro
:hardbreaks:
:nofooter:
:toclevels: 1
:icons: font
:linkattrs:
:imagesdir: ./media/

[.lead]
Anomaly Detection provides insight into anomalies in the patterns of data in your environment. An anomaly is a variation in a metric value for an object or group of objects, compared to historical information week over week. For example, if a pod's CPU utilization was at ~50% on Tuesday at 12:05 PM in the previous weeks, but is at 100% this Tuesday at 12:05 PM, that would be considered an anomaly.

== What is Anomaly Detection?

An anomaly occurs when the mean value of a metric is a number of standard deviations away from the weighted mean of that metric for the previous few weeks, with recent weeks having more weight than previous weeks. Cloud Insights provides the ability to monitor data and alert when anomalies are detected. You have a choice to set the "sensitivity" levels of detection. For example, a higher sensitivity would be when the mean value is fewer standard deviations from the mean, thus causing more alerts to be generated. Conversely, lower sensitivity = more standard deviations from mean = fewer alerts.

=== Anomaly Detection monitoring differs from Threshold Monitoring.

* *Threshold-based monitoring* works when you have pre-defined thresholds for specific metrics. In other words, when you have a clear understanding of what is expected.

image:MetricMonitor_blurb.png[Metric Monitors are for when you know the operating range]

* *Anomaly Detection monitoring* uses machine learning algorithms to identify outliers that deviate from the norm, for when the definition of normal is not clear.

image:ADMonitor_blurb.png[Anomaly Detection monitors are for when you want to know spikes or drops]


== When would I need Anomaly Detection?

Anomaly Detection monitoring can provide helpful alerts for many situations, including the following:

* When the definition of _normal_ is unclear.  For example, SAN error rates may be expected in varying amounts depending on port. Alerting on one error is noisy and unnecessary, but a sudden or significant increase could indicate a widespread issue.
* Where there are changes over time. Workloads that exhibit seasonality (i.e. they are busyor quiet at certain times). This could include unexpected quiet periods that may Indicate a batch stall.
* Working with large amounts of data where manually defining and adjusting thresholds is impractical. For example, an environment with a large numbers of hosts and/or volumes with varying workloads. Each may have different SLAs, so understanding the ones that exceed the norm is important.


// Because Anomaly Detection works by comparing a metric's data on a particular day and time to the same day and time from the previous week, once you create an Anomaly Detection monitor, Cloud Insights needs to collect data for seven days before it can alert on anomalies.

== Alerting on anomalies

To alert on anomalies, create a monitor by navigating to *Observability > Alerts > +Monitor*. Select _Anomaly Detection Monitor_ as the monitor type. 

image:Anomaly Detection Monitor Choice.png[Selecting Anomaly Detection when creating a monitor, width=480]

Choose the object and metric you want to monitor. You can set filters and grouping as with other types of monitors. 

Next, set the conditions for the monitor.  

* Trigger an alert when the selected metric either _Spikes above_ the predicted bounds, _Drops below_ those bounds, or both.
* Set sensitivity to _Medium_, _Low_ (fewer anomalies are detected), or _High_ (more anomalies are detected).
* Determine whether the alert level is _Critical_ or _Warning_.
* Optionally, set a value below which anomalies are _ignored_. This can help reduce noise. This value is shown as a dashed line on the sample graph.

image:Anomaly Detection Monitor Conditions.png[Setting conditions for Anomaly Detection monitor]

Finally, you can configure a delivery method for the alerts (email, webhook, or both), give the monitor an optional description or corrective actions, and add the monitor to a custom group, if desired.

Save the monitor with a meaningful name, and you're done. 

// NOTE: Remember that once the monitor is created or modified, it will take seven days before you will see any alerts.


== Viewing the Anomalies

On an alert landing page, alerts triggered when anomalies are detected will show a highlighted band in the chart, from the time when the metric spiked outside the predicted bounds to when it moved back inside those bounds. 

image:Anomaly_Detection_Chart_Example.png[Chart showing the time when an anomaly occurred]


