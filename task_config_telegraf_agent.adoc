---
sidebar: sidebar
permalink: task_config_telegraf_agent.html
keywords: telegraf, installation, install, agent, telegraf agent
summary: Cloud Insights supports link:https://docs.influxdata.com/telegraf/v1.14/[Telegraf] as its agent for collection of integration data and can be configured on Windows, Linux, macOS, and Kubernetes. 
---

= Configuring an Agent to Collect Data

:toc: macro
:hardbreaks:
:toclevels: 1
:nofooter:
:icons: font
:linkattrs:
:imagesdir: ./media/


[.lead]
Cloud Insights uses link:https://docs.influxdata.com/telegraf/v1.14/[Telegraf] as its agent for collection of integration data. Telegraf is a plugin-driven server agent that can be used to collect and report metrics, events, and logs. Input plugins are used to collect the desired information into the agent by accessing the system/OS directly, by calling third-party APIs, or by listening to configured streams (i.e. Kafka, statsD, etc). Output plugins are used to send the collected metrics, events, and logs from the agent to Cloud Insights. 

NOTE: For accurate audit and data reporting, it is strongly recommended to synchronize the time on the Agent machine using *Network Time Protocol (NTP)* or *Simple Network Time Protocol (SNTP)*.


== Installing an Agent

If you are installing a Service data collector and have not yet configured an Agent, you are prompted to first install an Agent for the appropriate Operating System. This topic provides instructions for installing the Telegraf agent on the following Operating Systems:

* <<Windows>>
* <<RHEL and CentOS>>
* <<Ubuntu and Debian>>
* <<macOS>>
* <<Kubernetes>>

To install an agent, regardless of the platform you are using, you must first do the following:

. Log into the host you will use for your agent. 
. Log in to your Cloud Insights site and go to *Admin > Data Collectors*.
. Click on *+Data Collector* and choose a data collector to install. 
////
There are several types of data collectors:
+
* *Host* (Windows, Linux, macOS, etc.)
+
* *Service* (integration with a wide variety of agent-collected plugins). Agents are configured and run as a service for RHEL/CentOS, Ubuntu/Debian, macOS, and Windows. For Kubernetes platforms, the agent in configured as a DaemonSet.
+
* *Infrastructure* (collects from storage, switch, cloud platform, etc.). Infrastructure collection is done with an link:task_configure_acquisition_unit.html[Acquisition Unit] instead of an Agent.
////
. Choose the appropriate platform for your host (Windows, Linux, macOS, etc.)
. Follow the remaining steps for each platform.

NOTE: Once you have installed an agent on a host, you do not need to install an agent again on that host. 

TIP: Once you have installed an agent on a server/VM, Cloud Insights collects metrics from that system in addition to collecting from any data collectors you configure. These metrics are gathered as link:task_config_telegraf_node.html["Node" metrics].

NOTE: If you are using a proxy, read the proxy instructions for your platform before installing the Telegraf agent.

=== Windows
image:AgentInstallWindows.png[Windows Agent Install]

.Pre-requisites:

* PowerShell must be installed
* If you are behind a proxy, follow the instructions in the *Configuring Proxy Support for Windows* section. 

.Steps to install agent on Windows:

. Choose an Agent Access Key.
. Copy the command block from the agent installation dialog. You can click the clipboard icon to quickly copy the command to the clipboard.
. Open a PowerShell window 
. Paste the command into the PowerShell window and press Enter.
. The command will download the appropriate agent installer, install it, and set a default configuration. When finished, it will restart the agent service. The command has a unique key and is valid for 24 hours. 
// . If you have already installed an agent on this host, you can skip the previous step.
. Click *Finish* or *Continue*


After the agent is installed, you can use the following commands to start/stop the service:

  Start-Service telegraf
  Stop-Service telegraf
  
[[windows-proxy]]  
==== Configuring Proxy Support for Windows

For systems residing behind a proxy, perform the following to set the _https_proxy_ and/or _http_proxy_ environment variable(s) *PRIOR* to installing the Telegraf agent:

 [System.Environment]::SetEnvironmentVariable(“https_proxy”, “<proxy_server>:<proxy_port>”, [System.EnvironmentVariableTarget]::Machine)


==== Uninstalling the Agent

To uninstall the agent on Windows, do the following in a PowerShell window:

. Stop and delete the Telegraf service:
+
 Stop-Service telegraf
 sc.exe delete telegraf
 
. Delete the _C:\Program Files\telegraf_ folder to remove the binary, logs, and configuration files

.  Remove the _SYSTEM\CurrentControlSet\Services\EventLog\Application\telegraf_ key from the registry

==== Upgrading the Agent

To upgrade the telegraf agent, do the following:

. Stop and delete the telegraf service:

 Stop-Service telegraf
 sc.exe delete telegraf

. Delete the _SYSTEM\CurrentControlSet\Services\EventLog\Application\telegraf_ key from the registry
. Delete _C:\Program Files\telegraf\telegraf.conf_
. Delete _C:\Program Files\telegraf\telegraf.exe_
. link:#windows[Install the new agent].



=== RHEL and CentOS

image:AgentInstallRHELCentOS.png[RHEL/CentOS Agent Install]

.Pre-requisites:

* The following commands must be available: curl, sudo, ping, and dmidecode
* If you are behind a proxy, follow the instructions in the *Configuring Proxy Support for RHEL/CentOS* section. 


.Steps to install agent on RHEL/CentOS:

. Choose an Agent Access Key.
. Copy the command block from the agent installation dialog. You can click the clipboard icon to quickly copy the command to the clipboard.
. Open a Bash window 
. Paste the command into the Bash window and press Enter.
. The command will download the appropriate agent installer, install it, and set a default configuration. When finished, it will restart the agent service. The command has a unique key and is valid for 24 hours. 
// . If you have already installed an agent on this host, you can skip the previous step.
. Click *Finish* or *Continue*

After the agent is installed, you can use the following commands to start/stop the service:

If your operating system is using systemd (CentOS 7+ and RHEL 7+):

 sudo systemctl start telegraf
 sudo systemctl stop telegraf

If your operating system is not using systemd (CentOS 7+ and RHEL 7+):

 sudo service telegraf start
 sudo service telegraf stop
 
==== Configuring Proxy Support for RHEL/CentOS

For systems residing behind a proxy, perform the following steps *PRIOR* to installing the Telegraf agent:

. Set the _https_proxy_ and/or _http_proxy_ environment variable(s) for the current user:
+
 export https_proxy=<proxy_server>:<proxy_port>

. Create _/etc/default/telegraf_, and insert definitions for the _https_proxy_ and/or _http_proxy_ variable(s):
+
 https_proxy=<proxy_server>:<proxy_port>



==== Uninstalling the Agent

To uninstall the agent on RHEL/CentOS, in a Bash terminal, do the following:

. Stop the Telegraf service:
+
 systemctl stop telegraf (If your operating system is using systemd (CentOS 7+ and RHEL 7+)
 /etc/init.d/telegraf stop (for systems without systemd support)

. Remove the Telegraf agent:
+
 yum remove telegraf

. Remove any configuration or log files that may be left behind:
+
 rm -rf /etc/telegraf*
 rm -rf /var/log/telegraf*

==== Upgrading the Agent

To upgrade the telegraf agent, do the following:

. Stop the telegraf service:

 systemctl stop telegraf (If your operating system is using systemd (CentOS 7+ and RHEL 7+)
 /etc/init.d/telegraf stop (for systems without systemd support)
 
. Remove the previous telegraf agent:

 yum remove telegraf

. link:#rhel-and-centos[Install the new agent].



=== Ubuntu and Debian

image:AgentInstallUbuntuDebian.png[Ubuntu/Debian Agent Install]

.Pre-requisites:

* The following commands must be available: curl, sudo, ping, and dmidecode
* If you are behind a proxy, follow the instructions in the *Configuring Proxy Support for Ubuntu/Debian* section. 


.Steps to install agent on Debian or Ubuntu:

. Choose an Agent Access Key.
. Copy the command block from the agent installation dialog. You can click the clipboard icon to quickly copy the command to the clipboard.
. Open a Bash window 
. Paste the command into the Bash window and press Enter.
. The command will download the appropriate agent installer, install it, and set a default configuration. When finished, it will restart the agent service. The command has a unique key and is valid for 24 hours. 
// . If you have already installed an agent on this host, you can skip the previous step.
. Click *Finish* or *Continue*

After the agent is installed, you can use the following commands to start/stop the service:

If your operating system is using systemd:

 sudo systemctl start telegraf
 sudo systemctl stop telegraf

If your operating system is not using systemd:

 sudo service telegraf start
 sudo service telegraf stop

==== Configuring Proxy Support for Ubuntu/Debian

For systems residing behind a proxy, perform the following steps *PRIOR* to installing the Telegraf agent:

. Set the _https_proxy_ and/or _http_proxy_ environment variable(s) for the current user:
+
 export https_proxy=<proxy_server>:<proxy_port>

. Create /etc/default/telegraf, and insert definitions for the _https_proxy_ and/or _http_proxy_ variable(s):
+
 https_proxy=<proxy_server>:<proxy_port>



==== Uninstalling the Agent

To uninstall the agent on Ubuntu/Debian, in a Bash terminal, run the following:

. Stop the Telegraf service:
+
 systemctl stop telegraf (If your operating system is using systemd)
 /etc/init.d/telegraf stop (for systems without systemd support)

. Remove the Telegraf agent:
+
 dpkg -r telegraf

. Remove any configuration or log files that may be left behind:
+
 rm -rf /etc/telegraf*
 rm -rf /var/log/telegraf*


==== Upgrading the Agent

To upgrade the telegraf agent, do the following:

. Stop the telegraf service:

 systemctl stop telegraf (If your operating system is using systemd)
 /etc/init.d/telegraf stop (for systems without systemd support)

. Remove the previous telegraf agent:

 dpkg -r telegraf

. link:#ubuntu-and-debian[Install the new agent].


=== macOS

image:AgentInstallMacOS.png[MacOS Agent Install]

.Pre-requisites:

* The "curl" command must be available
* If you are behind a proxy, follow the instructions in the *Configuring Proxy Support for macOS* section. 


.Steps to install agent on macOS:

. Choose an Agent Access Key.
. Copy the command block from the agent installation dialog. You can click the clipboard icon to quickly copy the command to the clipboard.
. Open a Bash window 
. Paste the command into the Bash window and press Enter.
. The command will download the appropriate agent installer, install it, and set a default configuration. When finished, it will restart the agent service. The command has a unique key and is valid for 24 hours. 
. If you previously installed a Telegraf agent using Homebrew, you will be prompted to uninstall it. Once the previously installed Telegraf agent is uninstalled, re-run the command in step 5 above.
. Click *Finish* or *Continue*

After the agent is installed, you can use the following commands to start/stop the service:

 sudo launchctl start telegraf
 sudo launchctl stop telegraf
 
==== Configuring Proxy Support for macOS
 
For systems residing behind a proxy, perform the following to set the _https_proxy_ and/or _http_proxy_ environment variable(s) for the current user *PRIOR* to installing the Telegraf agent:

export https_proxy=<proxy_server>:<proxy_port>

*AFTER* installing the Telegraf agent, add and set the appropriate _https_proxy_ and/or _http_proxy_ variable(s) in _/Applications/telegraf.app/Contents/telegraf.plist_:

 …
 <?xml version="1.0" encoding="UTF-8"?>
 <!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
 <plist version="1.0">
 <dict>
    <key>EnvironmentVariables</key>
    <dict>
           <key>https_proxy</key>
           <string><proxy_server>:<proxy_port></string>
    </dict>
    <key>Program</key>
    <string>/Applications/telegraf.app/Contents/MacOS/telegraf</string>
    <key>Label</key>
    <string>telegraf</string>
    <key>ProgramArguments</key>
    <array>
      <string>/Applications/telegraf.app/Contents/MacOS/telegraf</string>
      <string>--config</string>
      <string>/usr/local/etc/telegraf.conf</string>
      <string>--config-directory</string>
      <string>/usr/local/etc/telegraf.d</string>
    </array>
    <key>RunAtLoad</key>
    <true/>
 </dict>
 </plist>
 …

Then, restart Telegraf after loading the above changes:

 sudo launchctl stop telegraf
 sudo launchctl unload -w /Library/LaunchDaemons/telegraf.plist
 sudo launchctl load -w /Library/LaunchDaemons/telegraf.plist
 sudo launchctl start telegraf



==== Uninstalling the Agent

To uninstall the agent on macOS, in a Bash terminal, run the following:

. Stop the Telegraf service:
+
 sudo launchctl stop telegraf

. Uninstall the telegraf agent:
+
 cp /Applications/telegraf.app/scripts/uninstall /tmp
 sudo /tmp/uninstall

. Remove any configuration or log files that may be left behind:
+
 rm -rf /usr/local/etc/telegraf*
 rm -rf /usr/local/var/log/telegraf.*


==== Upgrading the Agent

To upgrade the telegraf agent, do the following:

. Stop the telegraf service:

 sudo launchctl stop telegraf

. Uninstall the previous telegraf agent:

 cp /Applications/telegraf.app/scripts/uninstall /tmp
 sudo /tmp/uninstall

. link:#macos[Install the new agent].



=== Kubernetes

image:Kubernetes_Install_Agent_screen.png[Kubernetes Agent Install]

.Pre-requisites:

* The following commands must be available: curl, sudo, kubectl
+
For best results, add these commands to the PATH.

* kube-state-metrics must be installed. See below for more infomation.

* If you are behind a proxy, follow the instructions in the *Configuring Proxy Support for Kubernetes* section. 

* If you are running a kubernetes variant that requires security context constraints, follow the instructions in the *Configuring the Agent to Collect Data from Kubernetes* section.


==== Monitoring is only installed on Linux nodes

Cloud Insights supports monitoring of Kubernetes nodes that are running Linux, by specifying a Kubernetes node selector that looks for the following Kubernetes labels on these platforms:

|===
|Platform|Label

|Kubernetes v1.14 and above |Kubernetes.io/os = linux
|Kubernetes v1.13 and below |beta.kubernetes.io/os = linux
|Rancher + cattle.io as orchestration/Kubernetes platform |cattle.io/os = linux
|===


==== Installation

.Steps to install agent on Kubernetes:

. Choose an Agent Access Key.
. Click the *Copy Agent Installer Snippet* button in the installation dialog. You can optionally click the _+Reveal Agent Installer Snippet_ button if you want to view the command block.
. Open a Bash window.
. Paste the command into the Bash window.
. Optionally, you can override the namespace or provide the cluster name as part of the install command by modifying the command block to add one or both of the following before the final _./$installerName_
** CLUSTER_NAME=<Cluster Name>
** NAMESPACE=<Namespace>
+
Scroll through the following example to see this in place in the command block:
+
 installerName=cloudinsights-kubernetes.sh && token=<token> && key=c642e336-91f4-4c6f-8086-72faabd6aff6 && domain=tenant1.testk8.cloudinsights-test.netapp.com && curl -k -X GET -H "Authorization: Bearer $token" -H "X-CloudInsights-ApiKey-Id: $key" -o $installerName https://$domain/rest/v1/lake/telegraf/platforms/installer?platform=kubernetes && chmod +x $installerName && sudo --preserve-env JWT=$token DOMAIN_NAME=$domain API_KEY_ID=$key CLUSTER_NAME=TEST_CLUSTER NAMESPACE=NEW-NAMESPACE ./$installerName
 
TIP: _CLUSTER_NAME_ is the name of the Kubernetes cluster from Cloud Insights collects metrics, while _NAMESPACE_ is the namespace to which the Telegraf agent will be deployed. The specified namespace will be created if it does not already exist.

. When ready, execute the command block.
. The command will download the appropriate agent installer, install it, and set a default configuration. If you have not explicitly set the _namespace_, you will be prompted to enter it. When finished, the script will restart the agent service. The command has a unique key and is valid for 24 hours. 
// . If you have already installed an agent on this host, you can skip the previous step.
. When finished, click *Complete Setup*.

After the agent is installed, generate the Telegraf DaemonSet YAML and ReplicaSet YAML using the following commands. Note that these commands are using the default namespace "ci-monitoring". 

If you have set your own namespace, substitute that namespace in these and all subsequent commands and files:

 kubectl --namespace ci-monitoring get ds telegraf-ds -o yaml > /tmp/telegraf-ds.yaml 
 kubectl --namespace ci-monitoring get rs telegraf-rs -o yaml > /tmp/telegraf-rs.yaml

You can use the following commands to stop and start the Telegraf service:

 kubectl --namespace ci-monitoring delete ds telegraf-ds
 kubectl --namespace ci-monitoring delete rs telegraf-rs
 
 kubectl --namespace ci-monitoring apply -f /tmp/telegraf-ds.yaml 
 kubectl --namespace ci-monitoring apply -f /tmp/telegraf-rs.yaml
 
==== Configuring Proxy Support for Kubernetes

For systems residing behind a proxy, perform the following to set the _https_proxy_ and/or _http_proxy_ environment variable(s) for the current user *PRIOR* to installing the Telegraf agent:

 export https_proxy=<proxy_server>:<proxy_port>

*AFTER* installing the Telegraf agent, add and set the appropriate _https_proxy_ and/or _http_proxy_ environment variable(s) to the _telegraf-ds_ daemonset and _telegraf-rs_ replicaset.

 kubectl edit ds telegraf-ds

 …
        env:
        - name: https_proxy
          value: <proxy_server>:<proxy_port>
        - name: HOSTIP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
 …

 kubectl edit rs telegraf-rs

 …
        env:
        - name: https_proxy
          value: <proxy_server>:<proxy_port>
        - name: HOSTIP
          valueFrom:
            fieldRef:
              apiVersion: v1
              fieldPath: status.hostIP
 …

Then, restart Telegraf:

 kubectl delete pod telegraf-ds-*
 kubectl delete pod telegraf-rs-*


 
==== Configuring the Agent to Collect Data from Kubernetes

For Kubernetes environments, Cloud Insights deploys the Telegraf agent as a DaemonSet and a ReplicaSet. The pods in which the agents run need to have access to the following:

* hostPath
* configMap
* secrets

These Kubernetes objects are automatically created as part of the Kubernetes agent install command provided in the Cloud Insights UI. Some variants of Kubernetes, such as OpenShift, implement an added level of security that may block access to these components. The _SecurityContextConstraint_ is not created as part of the Kubernetes agent install command provided in the Cloud Insights UI, and must be created manually. Once created, restart the Telegraf pod(s).

//In such cases, an additional manual step may be required.  As an example, for OpenShift, you may need to create a _SecurityContextConstraint_ to grant the telegraf-user ServiceAccount access to these components.

----
    apiVersion: v1
    kind: SecurityContextConstraints
    metadata:
      name: telegraf-hostaccess
      creationTimestamp:
      annotations:
        kubernetes.io/description: telegraf-hostaccess allows hostpath volume mounts for restricted SAs.
      labels:
        app: ci-telegraf
    priority: 10
    allowPrivilegedContainer: false
    defaultAddCapabilities: []
    requiredDropCapabilities: []
    allowedCapabilities: []
    allowedFlexVolumes: []
    allowHostDirVolumePlugin: true
    volumes:
    - hostPath
    - configMap
    - secret
    allowHostNetwork: false
    allowHostPorts: false
    allowHostPID: false
    allowHostIPC: false
    seLinuxContext:
      type: MustRunAs
    runAsUser:
      type: RunAsAny
    supplementalGroups:
      type: RunAsAny
    fsGroup:
      type: RunAsAny
    readOnlyRootFilesystem: false
    users:
    - system:serviceaccount:ci-monitoring:telegraf-user
    groups: []
----

==== Installing the kube-state-metrics server

When you install the kube-state-metrics server you can enable collection of the following Kubernetes objects: StatefulSet, DaemonSet, Deployment, PV, PVC, ReplicaSet, Service, Namespace, Secret, ConfigMap, Pod Volume, and Ingress. 

NOTE: It is strongly recommended to use kube-state-metrics version 2.0 or later in order to take advantage of the full feature set including the ability to link Kubernetes persistent volumes (PVs) to backend storage devices. 

Use the following steps to install the kube-state-metrics server:

.Steps

. Create a temporary folder (for example, _/tmp/kube-state-yaml-files/_) and copy the .yaml files from https://github.com/kubernetes/kube-state-metrics/tree/master/examples/standard to this folder. 

. Run the following command to apply the .yaml files needed for installing kube-state-metrics:

 kubectl apply -f /tmp/kube-state-yaml-files/


==== kube-state-metrics Counters
Use the following links to access information for the kube state metrics counters:

. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/configmap-metrics.md[ConfigMap Metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/daemonset-metrics.md[DaemonSet Metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/deployment-metrics.md[Deployment Metrics]
//. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/endpoint-metrics.md[Endpoint Metrics]
//. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/horizontalpodautoscaler-metrics.md[Horizontal Pod Autoscaler Metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/ingress-metrics.md[Ingress Metrics]
//. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/ingress-metrics.md[Job Metrics]
//. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/limitrange-metrics.md[LimitRange Metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/namespace-metrics.md[Namespace Metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/node-metrics.md[Node Metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/persistentvolume-metrics.md[Persistent Volume Metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/persistentvolumeclaim-metrics.md[Persistant Volume Claim Metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/pod-metrics.md[Pod Metrics]
//. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/poddisruptionbudget-metrics.md[Pod Disruption Budget Metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/replicaset-metrics.md[ReplicaSet metrics]
//. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/replicationcontroller-metrics.md[ReplicationController Metrics]   
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/secret-metrics.md[Secret metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/service-metrics.md[Service metrics]
. https://github.com/kubernetes/kube-state-metrics/blob/master/docs/statefulset-metrics.md[StatefulSet metrics]

==== Uninstalling the Agent

Note that these commands are using the default namespace "ci-monitoring".  If you have set your own namespace, substitute that namespace in these and all subsequent commands and files.

To uninstall the agent on Kubernetes, do the following:

If the monitoring namespace is being used solely for Telegraf:

 kubectl --namespace ci-monitoring delete ds,rs,cm,sa,clusterrole,clusterrolebinding -l app=ci-telegraf
 
 kubectl delete ns ci-monitoring

 
If the monitoring namespace is being used for other purposes in addition to Telegraf:

 kubectl --namespace ci-monitoring delete ds,rs,cm,sa,clusterrole,clusterrolebinding -l app=ci-telegraf

////
. Stop and delete the Telegraf service:

 kubectl --namespace ci-monitoring delete ds telegraf-ds 
 kubectl --namespace ci-monitoring delete rs telegraf-rs
 
. Delete the Telegraf ConfigMap and ServiceAccount:

 kubectl --namespace ci-monitoring delete cm telegraf-conf 
 kubectl --namespace ci-monitoring delete cm telegraf-conf-rs
 kubectl --namespace ci-monitoring delete sa telegraf-user 
 
. Delete the Telegraf ClusterRole and ClusterRolebinding:

 kubectl --namespace ci-monitoring delete clusterrole endpoint-access 
 kubectl --namespace ci-monitoring delete clusterrolebinding endpoint-access 
////
 
==== Upgrading the Agent
[#upgrading-kubernetes-agent]

Note that these commands are using the default namespace "ci-monitoring".  If you have set your own namespace, substitute that namespace in these and all subsequent commands and files.

To upgrade the telegraf agent, do the following:

. Back up the existing configurations:

 kubectl --namespace ci-monitoring get cm -o yaml > /tmp/telegraf-configs.yaml

. Uninstall the Agent (see above for instructions)

. link:#kubernetes[Install the new agent].

////
. Re-apply the configurations:

 kubectl --namespace ci-monitoring apply -f /tmp/telegraf-conf.yaml --force
 kubectl --namespace ci-monitoring apply -f /tmp/telegraf-conf-rs.yaml --force
 
. Restart all telegraf pods. Run the following command for each telegraf pod:

 kubectl --namespace ci-monitoring delete pod <Telegraf_pod>
////


== Troubleshooting Agent Installation

Some things to try if you encounter problems setting up an agent:

[cols=2*, options="header", cols"50,50"]
|===
|Problem:|Try this:
|I already installed an agent using Cloud Insights| If you have already installed an agent on your host/VM, you do not need to install the agent again. In this case, simply choose the appropriate Platform and Key in the Agent Installation screen, and click on *Continue* or *Finish*. 
|I already have an agent installed but not by using the Cloud Insights installer|Remove the previous agent and run the Cloud Insights Agent installation, to ensure proper default configuration file settings. When complete, click on *Continue* or *Finish*.
|I do not see a hyperlink/connection between my Kubernetes Persistent Volume and the corresponding back-end storage device. My Kubernetes Persistent Volume is configured using the hostname of the storage server.|Follow the steps to uninstall the existing Telegraf agent, then re-install the latest Telegraf agent.
|===

Additional information may be found from the link:concept_requesting_support.html[Support] page or in the link:https://docs.netapp.com/us-en/cloudinsights/CloudInsightsDataCollectorSupportMatrix.pdf[Data Collector Support Matrix].
